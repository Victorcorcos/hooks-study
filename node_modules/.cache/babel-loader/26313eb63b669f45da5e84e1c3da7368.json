{"ast":null,"code":"const domParse = require('./dom-parse.js');\n\nconst nodeStore = require('./nodeStore.js');\n\nconst assert = require('./assert.js');\n\nlet topNode;\nlet firstPass = true; // importing React from example app\n\nfunction injector(React, parentNode) {\n  topNode = parentNode;\n  startTraverse(parentNode);\n  const func = React.Component.prototype.setState;\n\n  React.Component.prototype.setState = function () {\n    // set timeout to delay traverse so that it is appended to original setState\n    startTraverse(this);\n\n    for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n      args[_key] = arguments[_key];\n    }\n\n    return func.apply(this, args);\n  }; // listens for messages from backgroundjs -> content script -> webpage\n\n\n  window.addEventListener('message', function (event) {\n    // only accept messges to self\n    if (event.source != window) return; // filter out other messages floating around in existing context\n\n    if (event.data.type === 'assertion') {\n      if (event.data.flag === 'onload') {\n        event.data.message.forEach(item => {\n          assert.addAssert(item);\n        });\n        startTraverse(parentNode);\n      } else if (event.data.flag === 'delete') {\n        assert.deleteBlock(event.data.message);\n      } else {\n        assert.addAssert(event.data.message);\n      }\n    }\n  }, false);\n}\n\nfunction startTraverse(self, reactDom) {\n  const nodePackage = {};\n  setTimeout(() => {\n    let travPromise = throttle(domParse.parser, 25);\n    travPromise.then(result => {\n      // Conditional to display feedback for react router incompatibility\n      if (result === 'react-router') {\n        window.postMessage({\n          type: 'virtualdom',\n          data: 'react-router'\n        }, \"*\");\n      } else {\n        nodePackage.virtualDom = result;\n        nodePackage.nodeStore = nodeStore.storage;\n        let title = document.title; // specify message type to target specific message\n\n        window.postMessage({\n          type: 'virtualdom',\n          data: nodePackage,\n          topNode: topNode.constructor.name,\n          title: title,\n          first: firstPass\n        }, \"*\");\n        firstPass = false;\n      }\n    });\n  }, 0);\n}\n\nfunction throttle(func, wait) {\n  let waiting = false;\n  return new Promise((resolve, reject) => {\n    if (waiting) reject();\n    waiting = true;\n    setTimeout(() => {\n      waiting = false;\n      let result = func(topNode);\n      resolve(result);\n    }, wait);\n    return func(topNode);\n  });\n}\n\nmodule.exports = injector;","map":{"version":3,"names":["domParse","require","nodeStore","assert","topNode","firstPass","injector","React","parentNode","startTraverse","func","Component","prototype","setState","args","apply","window","addEventListener","event","source","data","type","flag","message","forEach","item","addAssert","deleteBlock","self","reactDom","nodePackage","setTimeout","travPromise","throttle","parser","then","result","postMessage","virtualDom","storage","title","document","constructor","name","first","wait","waiting","Promise","resolve","reject","module","exports"],"sources":["/Users/victorcosta/Desktop/repositories/react-project/hooks-study/node_modules/react-vt/src/inject.js"],"sourcesContent":["const domParse = require('./dom-parse.js');\nconst nodeStore = require('./nodeStore.js');\n\nconst assert = require('./assert.js');\nlet topNode;\nlet firstPass = true;  \n\n// importing React from example app\nfunction injector(React, parentNode) {\n  topNode = parentNode;\n  startTraverse(parentNode);\n  const func = React.Component.prototype.setState;\n  React.Component.prototype.setState = function(...args) {\n    // set timeout to delay traverse so that it is appended to original setState\n    startTraverse(this);\n    return func.apply(this, args);\n  }\n  // listens for messages from backgroundjs -> content script -> webpage\n  window.addEventListener('message', function(event) {\n    // only accept messges to self\n    if (event.source != window) return;\n    // filter out other messages floating around in existing context\n\n    if (event.data.type === 'assertion') {\n      if (event.data.flag === 'onload') {\n        event.data.message.forEach(item => {\n          assert.addAssert(item); \n        });\n        startTraverse(parentNode);\n      } else if (event.data.flag === 'delete') {\n        assert.deleteBlock(event.data.message);\n      } else {\n        assert.addAssert(event.data.message);\n      }\n    }\n  }, false);\n}\n\nfunction startTraverse(self, reactDom) {\n  const nodePackage = {}; \n  setTimeout(()=> {\n      let travPromise = throttle(domParse.parser, 25);\n      travPromise.then((result) => {\n        // Conditional to display feedback for react router incompatibility\n        if (result === 'react-router') {\n          window.postMessage({ type: 'virtualdom', data: 'react-router' }, \"*\");\n        } else {\n          nodePackage.virtualDom = result;\n          nodePackage.nodeStore = nodeStore.storage;\n          let title = document.title;\n          // specify message type to target specific message\n          window.postMessage({ type: 'virtualdom', data: nodePackage, topNode: topNode.constructor.name, title: title, first: firstPass}, \"*\");\n          firstPass = false;\n        }\n      });\n  }, 0);\n}\n\nfunction throttle(func, wait) {\n  let waiting = false; \n  return new Promise((resolve, reject) => {\n    if (waiting) reject(); \n    waiting = true; \n    setTimeout(() => {\n      waiting = false;\n      let result = func(topNode);\n      resolve(result);\n    }, wait);\n   return func(topNode);\n  }); \n}\n\nmodule.exports = injector;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}